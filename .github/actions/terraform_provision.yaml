name: "Terraform Provision Custom Action"
description: "Setup and apply Terraform configurations"
inputs:
  terraform_version:
    description: "Terraform version to use"
    required: true
  tf_workspace:
    description: "Terraform workspace name"
    required: true
  docker_image:
    description: "Docker image to deploy"
    required: true

runs:
  using: "composite"
  steps:
    - name: "Checkout repository"
      uses: actions/checkout@v3

    - name: Set up Terraform
      uses: hashicorp/setup-terraform@v3
      with:
        terraform_version: ${{ inputs.terraform_version }}
        cli_config_credentials_token: ${{ secrets.TF_API_TOKEN }}

    - name: Terraform Init and Apply
      run: |
          cd ./terraform
          terraform init
          terraform apply -auto-approve \
          -var-file="variables/${{ inputs.tf_workspace }}.tfvars" \
          -var="docker_image=${{ inputs.docker_image }}"
      env:
        TF_API_TOKEN: ${{ secrets.TF_API_TOKEN }}
